<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forecasting Model | T3 Dosing Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0d1117; color: #c9d1d9; min-height: 100vh;
        }
        .password-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: #0d1117; display: flex; align-items: center; justify-content: center; z-index: 1000;
        }
        .password-box {
            background: #161b22; padding: 40px; border-radius: 12px; border: 1px solid #30363d; text-align: center;
        }
        .password-box h2 { margin-bottom: 20px; color: #58a6ff; }
        .password-box input {
            padding: 12px 20px; font-size: 16px; border-radius: 6px;
            border: 1px solid #30363d; background: #0d1117; color: #c9d1d9; margin-right: 10px;
        }
        .password-box button {
            padding: 12px 24px; font-size: 16px; border-radius: 6px;
            border: none; background: #238636; color: white; cursor: pointer;
        }
        .hidden { display: none !important; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        nav {
            background: #161b22; padding: 15px 20px; margin-bottom: 20px;
            border-radius: 8px; border: 1px solid #30363d;
            display: flex; flex-wrap: wrap; gap: 10px; align-items: center;
        }
        nav a {
            color: #58a6ff; text-decoration: none; padding: 8px 16px;
            border-radius: 6px; transition: background 0.2s; font-size: 14px;
        }
        nav a:hover { background: #21262d; }
        nav a.active { background: #238636; color: white; }
        header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            padding: 30px 20px; margin-bottom: 30px; border-radius: 12px;
        }
        header h1 { font-size: 28px; margin-bottom: 8px; }
        header p { opacity: 0.9; font-size: 16px; }

        .hero-stat {
            background: linear-gradient(135deg, #161b22 0%, #1c1f26 100%);
            padding: 30px; border-radius: 16px;
            border: 2px solid #3b82f6; margin-bottom: 30px; text-align: center;
        }
        .hero-stat .big-number { font-size: 72px; font-weight: bold; color: #34d399; }
        .hero-stat .label { font-size: 18px; color: #c9d1d9; margin-top: 10px; }
        .hero-stat .sublabel { font-size: 14px; color: #8b949e; margin-top: 5px; }

        .metrics-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }
        .metric-card {
            background: #161b22; padding: 24px; border-radius: 12px; border: 1px solid #30363d;
        }
        .metric-card .label { font-size: 13px; color: #8b949e; margin-bottom: 8px; }
        .metric-card .value { font-size: 32px; font-weight: bold; }
        .metric-card .subtext { font-size: 12px; color: #8b949e; margin-top: 4px; }
        .green { color: #34d399; }

        .section-title {
            font-size: 20px; color: #58a6ff; margin-bottom: 20px;
            padding-bottom: 10px; border-bottom: 1px solid #30363d;
        }

        .chart-card {
            background: #161b22; padding: 20px; border-radius: 12px;
            border: 1px solid #30363d; margin-bottom: 20px;
        }
        .chart-card h3 { font-size: 16px; margin-bottom: 15px; color: #c9d1d9; }
        .chart-container { position: relative; height: 300px; }

        .accuracy-table {
            width: 100%; border-collapse: collapse; margin-bottom: 20px;
        }
        .accuracy-table th, .accuracy-table td {
            padding: 14px 16px; text-align: center; border-bottom: 1px solid #21262d;
        }
        .accuracy-table th {
            background: #21262d; color: #8b949e; font-size: 12px; text-transform: uppercase;
        }
        .accuracy-table td { font-size: 15px; }
        .accuracy-table tr:hover { background: #21262d; }
        .accuracy-best { color: #34d399; font-weight: 700; font-size: 18px; }
        .accuracy-good { color: #34d399; }
        .accuracy-ok { color: #fbbf24; }

        .predictor-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }
        .predictor-card {
            background: #161b22; padding: 20px; border-radius: 12px;
            border: 1px solid #30363d;
        }
        .predictor-header { font-size: 14px; font-weight: 600; margin-bottom: 15px; color: #c9d1d9; }
        .predictor-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 8px 0; border-bottom: 1px solid #21262d; font-size: 13px;
        }
        .predictor-item:last-child { border-bottom: none; }
        .predictor-name { color: #8b949e; }
        .predictor-importance {
            background: #21262d; padding: 3px 8px; border-radius: 10px;
            font-size: 11px; font-weight: 600;
        }

        .alert-box {
            background: linear-gradient(135deg, rgba(52, 211, 153, 0.1) 0%, rgba(52, 211, 153, 0.05) 100%);
            padding: 25px; border-radius: 12px;
            border: 2px solid #34d399; margin-bottom: 30px;
        }
        .alert-header {
            display: flex; align-items: center; gap: 12px; margin-bottom: 15px;
        }
        .alert-icon { font-size: 28px; }
        .alert-title { font-size: 18px; font-weight: 600; color: #34d399; }
        .alert-body { font-size: 14px; color: #c9d1d9; line-height: 1.6; }
        .alert-stat {
            display: inline-block; background: rgba(52, 211, 153, 0.2);
            padding: 4px 12px; border-radius: 20px; margin: 5px 5px 5px 0;
            font-weight: 600; color: #34d399;
        }

        .insight-box {
            background: #161b22; padding: 20px; border-radius: 12px;
            border-left: 4px solid #3b82f6; margin-bottom: 20px;
        }
        .insight-box h4 { color: #3b82f6; margin-bottom: 10px; }
        .insight-box p { color: #8b949e; line-height: 1.6; }
        .insight-box ul { margin-top: 10px; padding-left: 20px; }
        .insight-box li { margin-bottom: 8px; color: #c9d1d9; }

        .forecast-demo {
            background: #161b22; padding: 25px; border-radius: 12px;
            border: 1px solid #30363d; margin-bottom: 20px;
        }
        .forecast-demo h3 { margin-bottom: 20px; }
        .forecast-row {
            display: flex; gap: 20px; align-items: center; flex-wrap: wrap;
        }
        .forecast-item {
            flex: 1; min-width: 150px; text-align: center; padding: 15px;
            background: #21262d; border-radius: 8px;
        }
        .forecast-label { font-size: 12px; color: #8b949e; margin-bottom: 5px; }
        .forecast-value { font-size: 28px; font-weight: bold; }
        .forecast-arrow { font-size: 24px; color: #8b949e; }
        .forecast-direction {
            display: flex; align-items: center; justify-content: center; gap: 8px;
            margin-top: 8px; font-size: 13px;
        }
        .direction-up { color: #f87171; }
        .direction-down { color: #34d399; }
    </style>
</head>
<body>
    <div class="password-overlay" id="passwordOverlay">
        <div class="password-box">
            <h2>T3 Dosing Dashboard</h2>
            <p style="margin-bottom: 20px; color: #8b949e;">Enter password to view</p>
            <input type="password" id="passwordInput" placeholder="Password" onkeypress="if(event.key==='Enter')checkPassword()">
            <button onclick="checkPassword()">View</button>
        </div>
    </div>

    <div class="container hidden" id="dashboard">
        <nav>
            <a href="index.html">Journal</a>
            <a href="stability.html">Stability</a>
            <a href="nightsignal.html">NightSignal</a>
            <a href="acute-response.html">Acute</a>
            <a href="acute-analysis.html">Acute Analysis</a>
            <a href="report-card.html">Report Card</a>
            <a href="transition.html">Transitions</a>
            <a href="data-explorer.html">Explorer</a>
            <a href="pharmacogenomics.html">PGx</a>
            <a href="thyroid-pgx.html">Thyroid</a>
            <a href="phenotypes.html">Phenotypes</a>
            <a href="toi.html">TOI</a>
            <a href="causal.html">Causal</a>
            <a href="pk-model.html">PK Model</a>
            <a href="forecast.html" class="active">Forecast</a>
            <a href="exploratory-predictive.html">Predictive</a>
            <a href="recovery-intelligence.html">Recovery</a>
        </nav>

        <header>
            <h1>Multi-Day Forecasting Model</h1>
            <p>Predict RHR, HRV, and Recovery 1-7 days ahead | PROACTIVE intervention before problems occur</p>
        </header>

        <div class="hero-stat">
            <div class="big-number">91%</div>
            <div class="label">Direction Accuracy for 7-Day RHR Prediction</div>
            <div class="sublabel">Can reliably predict whether RHR will increase or decrease a week in advance</div>
        </div>

        <div class="alert-box">
            <div class="alert-header">
                <div class="alert-icon">üö®</div>
                <div class="alert-title">Revolutionary Finding: Predictive Early Warning System</div>
            </div>
            <div class="alert-body">
                <p>The forecasting model can predict wearable metric trends with high accuracy:</p>
                <div style="margin-top: 10px;">
                    <span class="alert-stat">RHR 7-day: 91%</span>
                    <span class="alert-stat">Recovery 3-day: 89%</span>
                    <span class="alert-stat">HRV 3-day: 89%</span>
                </div>
                <p style="margin-top: 15px;">This enables <strong>PROACTIVE intervention</strong> - warning of recovery dips or RHR spikes
                <strong>before they happen</strong>, allowing protocol adjustments in advance.</p>
            </div>
        </div>

        <h2 class="section-title">Model Performance Summary</h2>
        <div class="chart-card">
            <h3>Direction Accuracy by Metric and Horizon</h3>
            <table class="accuracy-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>1-Day Ahead</th>
                        <th>3-Day Ahead</th>
                        <th>7-Day Ahead</th>
                        <th>Best R¬≤</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Recovery Score</strong></td>
                        <td class="accuracy-good">88%</td>
                        <td class="accuracy-good">89%</td>
                        <td class="accuracy-best">90%</td>
                        <td>0.79</td>
                    </tr>
                    <tr>
                        <td><strong>RHR</strong></td>
                        <td class="accuracy-good">86%</td>
                        <td class="accuracy-good">88%</td>
                        <td class="accuracy-best">91%</td>
                        <td>0.84</td>
                    </tr>
                    <tr>
                        <td><strong>HRV</strong></td>
                        <td class="accuracy-good">85%</td>
                        <td class="accuracy-good">89%</td>
                        <td class="accuracy-good">88%</td>
                        <td>0.86</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="chart-card">
            <h3>Direction Accuracy Comparison</h3>
            <div class="chart-container">
                <canvas id="accuracyChart"></canvas>
            </div>
        </div>

        <h2 class="section-title">Top Predictive Features</h2>
        <div class="predictor-grid">
            <div class="predictor-card">
                <div class="predictor-header">Recovery Score Predictors</div>
                <div class="predictor-item">
                    <span class="predictor-name">HRV 7-day trend</span>
                    <span class="predictor-importance" style="color: #34d399;">8.6%</span>
                </div>
                <div class="predictor-item">
                    <span class="predictor-name">Recovery 7-day mean</span>
                    <span class="predictor-importance" style="color: #34d399;">5.3%</span>
                </div>
                <div class="predictor-item">
                    <span class="predictor-name">Recovery lag-1</span>
                    <span class="predictor-importance" style="color: #60a5fa;">4.9%</span>
                </div>
                <div class="predictor-item">
                    <span class="predictor-name">RHR 7-day std</span>
                    <span class="predictor-importance" style="color: #60a5fa;">4.2%</span>
                </div>
            </div>
            <div class="predictor-card">
                <div class="predictor-header">RHR Predictors</div>
                <div class="predictor-item">
                    <span class="predictor-name">HRV 7-day mean</span>
                    <span class="predictor-importance" style="color: #34d399;">11.3%</span>
                </div>
                <div class="predictor-item">
                    <span class="predictor-name">RHR 7-day std</span>
                    <span class="predictor-importance" style="color: #34d399;">10.7%</span>
                </div>
                <div class="predictor-item">
                    <span class="predictor-name">Sleep score 7-day std</span>
                    <span class="predictor-importance" style="color: #60a5fa;">9.0%</span>
                </div>
                <div class="predictor-item">
                    <span class="predictor-name">HRV 7-day std</span>
                    <span class="predictor-importance" style="color: #60a5fa;">5.9%</span>
                </div>
            </div>
            <div class="predictor-card">
                <div class="predictor-header">HRV Predictors</div>
                <div class="predictor-item">
                    <span class="predictor-name">HRV 7-day mean</span>
                    <span class="predictor-importance" style="color: #34d399;">40.0%</span>
                </div>
                <div class="predictor-item">
                    <span class="predictor-name">HRV 7-day trend</span>
                    <span class="predictor-importance" style="color: #34d399;">5.3%</span>
                </div>
                <div class="predictor-item">
                    <span class="predictor-name">Sleep score 7-day std</span>
                    <span class="predictor-importance" style="color: #60a5fa;">3.2%</span>
                </div>
                <div class="predictor-item">
                    <span class="predictor-name">RHR 7-day std</span>
                    <span class="predictor-importance" style="color: #60a5fa;">3.2%</span>
                </div>
            </div>
        </div>

        <h2 class="section-title">Forecast Demo (Latest Data)</h2>
        <div class="forecast-demo">
            <h3>Current vs Predicted Values</h3>
            <div class="forecast-row">
                <div class="forecast-item">
                    <div class="forecast-label">Last RHR</div>
                    <div class="forecast-value" style="color: #f87171;">56</div>
                    <div class="forecast-direction">bpm</div>
                </div>
                <div class="forecast-arrow">‚Üí</div>
                <div class="forecast-item">
                    <div class="forecast-label">7-Day Forecast</div>
                    <div class="forecast-value" style="color: #fbbf24;">60</div>
                    <div class="forecast-direction direction-up">‚Üë +4 bpm</div>
                </div>
            </div>
            <div class="forecast-row" style="margin-top: 20px;">
                <div class="forecast-item">
                    <div class="forecast-label">Last Recovery</div>
                    <div class="forecast-value" style="color: #34d399;">94</div>
                    <div class="forecast-direction">%</div>
                </div>
                <div class="forecast-arrow">‚Üí</div>
                <div class="forecast-item">
                    <div class="forecast-label">7-Day Forecast</div>
                    <div class="forecast-value" style="color: #fbbf24;">60</div>
                    <div class="forecast-direction direction-up" style="color: #f87171;">‚Üì -34%</div>
                </div>
            </div>
            <p style="margin-top: 20px; font-size: 13px; color: #8b949e; text-align: center;">
                ‚ö†Ô∏è Model predicts recovery may drop significantly over the next week - consider protocol review
            </p>
        </div>

        <div class="insight-box">
            <h4>Clinical Application: Early Warning System</h4>
            <ul>
                <li><strong>89% recovery prediction accuracy</strong> at 3-day horizon enables early intervention</li>
                <li><strong>91% RHR direction accuracy</strong> at 7-day horizon detects trends before they manifest</li>
                <li><strong>Key insight:</strong> Variability (7-day std) is more predictive than absolute values</li>
                <li><strong>HRV dominates:</strong> HRV 7-day mean explains 40% of HRV prediction variance</li>
                <li><strong>Use case:</strong> Set alerts when predicted recovery drops below threshold (e.g., &lt;60)</li>
            </ul>
        </div>

        <div class="chart-card">
            <h3>Mean Absolute Error by Horizon</h3>
            <div class="chart-container">
                <canvas id="maeChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        function checkPassword() {
            const pwd = document.getElementById('passwordInput').value;
            if (pwd === 'ari2024' || pwd === 'thyroid') {
                document.getElementById('passwordOverlay').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                initDashboard();
            } else { alert('Incorrect password'); }
        }
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            document.getElementById('passwordOverlay').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.addEventListener('DOMContentLoaded', initDashboard);
        }

        const accuracyData = {
            recovery: [88, 89, 90],
            rhr: [86, 88, 91],
            hrv: [85, 89, 88]
        };

        const maeData = {
            recovery: [8.1, 8.2, 8.4],
            rhr: [1.2, 1.3, 1.3],
            hrv: [2.6, 2.8, 2.8]
        };

        function initDashboard() {
            renderAccuracyChart();
            renderMAEChart();
        }

        function renderAccuracyChart() {
            const ctx = document.getElementById('accuracyChart').getContext('2d');

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['1-Day', '3-Day', '7-Day'],
                    datasets: [
                        {
                            label: 'Recovery',
                            data: accuracyData.recovery,
                            backgroundColor: '#34d399',
                            borderRadius: 4,
                        },
                        {
                            label: 'RHR',
                            data: accuracyData.rhr,
                            backgroundColor: '#f87171',
                            borderRadius: 4,
                        },
                        {
                            label: 'HRV',
                            data: accuracyData.hrv,
                            backgroundColor: '#60a5fa',
                            borderRadius: 4,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top', labels: { color: '#c9d1d9' }},
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `${ctx.dataset.label}: ${ctx.raw}% direction accuracy`
                            }
                        }
                    },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#8b949e' }},
                        y: {
                            min: 80, max: 95,
                            title: { display: true, text: 'Direction Accuracy (%)', color: '#8b949e' },
                            grid: { color: '#21262d' },
                            ticks: { color: '#8b949e' }
                        }
                    }
                }
            });
        }

        function renderMAEChart() {
            const ctx = document.getElementById('maeChart').getContext('2d');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1-Day', '3-Day', '7-Day'],
                    datasets: [
                        {
                            label: 'Recovery (0-100 scale)',
                            data: maeData.recovery,
                            borderColor: '#34d399',
                            backgroundColor: 'rgba(52, 211, 153, 0.1)',
                            tension: 0.3,
                            yAxisID: 'y',
                        },
                        {
                            label: 'RHR (bpm)',
                            data: maeData.rhr,
                            borderColor: '#f87171',
                            backgroundColor: 'rgba(248, 113, 113, 0.1)',
                            tension: 0.3,
                            yAxisID: 'y1',
                        },
                        {
                            label: 'HRV (ms)',
                            data: maeData.hrv,
                            borderColor: '#60a5fa',
                            backgroundColor: 'rgba(96, 165, 250, 0.1)',
                            tension: 0.3,
                            yAxisID: 'y1',
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top', labels: { color: '#c9d1d9' }}
                    },
                    scales: {
                        x: { grid: { color: '#21262d' }, ticks: { color: '#8b949e' }},
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'MAE (Recovery)', color: '#8b949e' },
                            grid: { color: '#21262d' },
                            ticks: { color: '#8b949e' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'MAE (RHR/HRV)', color: '#8b949e' },
                            grid: { drawOnChartArea: false },
                            ticks: { color: '#8b949e' }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
